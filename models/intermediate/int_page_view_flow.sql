SELECT SESSION_DATE,
    FROM_PAGE,
    TO_PAGE,
    COUNT(DISTINCT SESSION_ID) AS SESSION_COUNT
FROM
(
    SELECT CAST(SESSION_AT_TS AS DATE) AS SESSION_DATE
        , PAGE_NAME AS FROM_PAGE
        , LEAD(PAGE_NAME) OVER (PARTITION BY A.SESSION_ID ORDER BY VIEW_AT_TS) AS TO_PAGE
        , A.SESSION_ID AS SESSION_ID
    FROM {{ ref('base_web_page_views') }} A
    INNER JOIN {{ ref('base_web_sessions') }} B
    ON A.SESSION_ID = B.SESSION_ID
)
WHERE TO_PAGE IS NOT NULL
GROUP BY 1, 2, 3
ORDER BY 1, 2, 3